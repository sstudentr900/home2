<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="../css/customPrism.css"> -->
    <!-- <link rel="stylesheet" href="../css/prism.css"> -->
    <!-- <script src="../js/prism.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script> -->
  </head>
  <body>
    <div id="program">
      
      <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;500;700;900&family=Noto+Serif+TC:wght@300;500;700;900&display=swap" rel="stylesheet">
      <style>
        *{
          box-sizing: border-box;
        }
        html,body{
          padding: 0;
          margin: 0;
        }
        body{
          font-family: 'Noto Sans TC';
          /* font-family: 思源黑體, 微軟正黑體, 蘋方體, 黑體, sans-serif, serif; */
          background: linear-gradient(45deg, rgba(66, 183, 245, 0.8) 0%, rgba(66, 245, 189, 0.4) 100%);
          /* background: #4f52af; */
          /* background: #ddeefc; */
          /* font-family: 'Rozha One', serif; */
          /* background-size: cover;
          background-color: #8086a0;
          background-image: linear-gradient(217deg, rgba(220, 20, 60, 0.8), rgba(220, 20, 60, 0) 70.71%), linear-gradient(127deg, #8086a0, rgba(128, 134, 160, 0) 70.71%), linear-gradient(336deg, rgba(100, 149, 237, 0.8), rgba(100, 149, 237, 0) 70.71%); */
        }
        ul{
          list-style: none;
          padding: 0;
        }

        /**/
        #program{
          user-select: none;
          height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
          flex-wrap: wrap;
          padding: 40px 20px;
          /* max-width: 720px; */
          margin: 0 auto;
        }
        /* #program:before {
          content: "";
          width: 100%;
          height: 100%;
          position: absolute;
          z-index: -1;
          left: 0;
          top: 0;
          background-image: url(https://images.unsplash.com/photo-1508247967583-7d982ea01526?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2250&q=80);
          background-repeat: no-repeat;
          background-size: cover;
          background-position: center;
          filter: blur(50px);
          opacity: 0.3;
      } */
        /* #program::before {
          content: "";
          display: block;
          position: fixed;
          width: 300%;
          height: 100%;
          top: 50%;
          left: 50%;
          border-radius: 100%;
          transform: translateX(-50%) skewY(-8deg);
          background-color: #f6c90e;
          z-index: -1;
          animation: wave 8s ease-in-out infinite alternate;
        } */

        /*box*/
        #program .box{
          width: 520px;
          margin: auto;
          padding: 40px 30px;
          position: relative;
          overflow: hidden;
          /* background: #fff; */
          /* box-shadow: 0 3.2px 2.2px rgb(0 0 0 / 2%), 0 7px 5.4px rgb(0 0 0 / 3%), 0 12.1px 10.1px rgb(0 0 0 / 4%), 0 19.8px 18.1px rgb(0 0 0 / 4%), 0 34.7px 33.8px rgb(0 0 0 / 5%), 0 81px 81px rgb(0 0 0 / 7%); */
          background-color: #fff;
          /* border-radius: 4px; */
          /* border-radius: 30px;
          background-color: #1e1f30; */
          /* border-radius: 6px; */
          /* box-shadow: 0 1px 30px rgb(0 0 0 / 80%); */
          border-radius: 4px;
          box-shadow: 0 0 30px rgb(0 0 0 / 10%);
          /* background: rgba(255, 255, 255, 0.375);
          box-shadow: 0 0.75rem 2rem 0 rgb(0 0 0 / 10%);
          border: 1px solid rgba(255, 255, 255, 0.125);
          padding-top: 160px; */
        }
        /* #program .box::before {
          content: "";
          display: block;
          position: absolute;
          width: 400px;
          height: 400px;
          border-radius: 100%;
          background-color: #2364d2;
          top: -207px;
          right: -236px;
          z-index: 0;
        } */
        #program .title{
          color: #4285F4;
          font-size: 66px;
          font-weight: 900;
          padding: 0;
          margin: 0 0 26px;
          letter-spacing: 4px;
          text-align: center;
          font-style: italic;
          line-height: 1;
        }
        /*select*/
        #program .selectOutLine{
          /* width: 60%;
          margin: auto; */
          /* margin-bottom: 2rem; */
          /* padding: 3rem 2rem; */
          /* border: 2px solid rgba(255, 255, 255, 0.5); */
          /* border-radius: 1rem; */
          /* font-size: 2rem; */
          font-size: 16px;
          font-weight: bold;
          padding: 10px 20px;
          /* color: #fff; */
          color: #4285F4;
          color: #00000099;
          /* margin: 10px 0 20px; */
          margin: 10px 0 10px;
          /* text-shadow: 0 4px 0 rgb(0 0 0 / 12%); */
          background: rgba(0, 0, 0, 0.1);
          text-align: center;
          border-radius: 4px;
          /* text-align: center; */
          /* color: #fff; */
          /* background: #121122;
          box-shadow: 0 20px 60px 0 rgb(14 42 90 / 55%);
          margin-bottom: -130px;
          position: relative;
          z-index: 2; */
          /* box-shadow: 0 3px 5px rgb(0 0 0 / 40%);
          background: rgba(255,255,255,.3); */
            /* border-radius: 2rem; */
          /* background: rgba(255, 255, 255, 0.375);
          box-shadow: 0 0.75rem 2rem 0 rgb(0 0 0 / 10%);
          border: 1px solid rgba(255, 255, 255, 0.125); */
        }
        #program .select{
          overflow: hidden;
          height: 22px;
          /* background: #333; */
          /* border-radius: 0.5rem; */
          /* border: 1px solid rgba(41, 44, 55, 0.27); */
        }
        #program .select ul{
          margin: 0;
          position: relative;
          animation-iteration-count: infinite;
          animation-timing-function: linear;
        }
        #program .select ul.active{
          /* animation-duration: 2s; */
          animation-name: spin;
        }
        #program .select li{
          font-weight: 500;
          height: 22px;
          line-height: 22px;
        }
        @keyframes spin{
          from {
            transform: translateY(calc(-100% + 22px));
          }
          to {
            transform: translateY(0);
          }
        }

        /*button*/
        /* #program .button{
          width: 70%;
          margin: auto;
        } */
        #program .button button{
          /* width: 100%;
          padding: 1rem;
          font-size: 2rem;
          background: #fabd18;
          color: #000;
          font-weight: 100;
          cursor: pointer;
          border: none;
          border-radius: 0.5rem; */
          width: 100%;
          /* height: 55px; */
          background: #4285F4;
          border: none;
          color: #fff;
          border-radius: 4px;
          padding: 10px 20px;
          /* margin-left: auto; */
          /* box-shadow: 0 0 20px #1b86f9; */
          /* cursor: pointer; */
          /* background: #2364d2; 
          border-radius: 5px;*/
          /* background-color: #a41935; */
          /* border-radius: 100px; */
          /* border: none; */
          font-size: 18px;
          /* box-shadow: 0 1px 3px rgb(0 0 0 / 50%); */
          font-weight: 500;
          /* font-family: "Source Sans Pro", sans-serif; 
          box-shadow: 3px 10px 20px 0px rgb(35 100 210 / 30%);*/
          color: #fff;
          margin-top: 20px;
          cursor: pointer;
        }
        #program .button.not-allow{
          pointer-events: none;
        }

        /*map*/
        #program .map{
          /* width: 100%; */
          /* border-radius: 30px; */
          overflow: hidden;
          position: relative;
          z-index: 2;
          border: 1px solid #eee;
          background-color: rgb(225, 231, 237);
          /* text-align: center; */
        }
        #program .map iframe{
          /* width: 80%; */
          width: 100%;
          transition: all 0.5s ease;
        }
        #program .map .hidden {
          visibility: hidden;
          opacity: 0;
        }
      </style>
      <div class="box">
        <h2 class="title">現在要吃什麼?</h2>
        <!--  select  -->
        <div class="selectOutLine">
          <div class="select">
            <ul></ul>
          </div>
        </div>
   
        <!--  地圖  -->
        <!-- <p>google map</p> -->
        <section class="map">
          <iframe
            width="600"
            height="450"
            style="border:0"
            loading="lazy"
            allowfullscreen
            referrerpolicy="no-referrer-when-downgrade"
          ></iframe>
        </section>
        <!--  按鈕  -->
        <div class="button">
          <button>送出</button>
        </div>
      </div>
      <script>
        //https://sheets.googleapis.com/v4/spreadsheets/{表單id}/values/{表單名稱}?alt=json&key={API金鑰}
        const uri = 'https://sheets.googleapis.com/v4/spreadsheets/13fLPsJrjKANkrStkhh1NKOwrdQ61SEafX1OTUFyBuTs/values/Sheet1?alt=json&key=AIzaSyBjQzpKIdXs5vEoOCh2vLj-8sF4XdXjnfI';
        fetch(uri)
        .then(res=>res.json())
        .then(data=>{
          const select = document.querySelector('.select>ul');
          const button = document.querySelector('.button');
          const items = getData(data.values);
          //map
          function mapFn(txt,button){
            const map = document.querySelector('.map iframe');
            map.src = 'https://www.google.com/maps/embed/v1/place?key=AIzaSyDtu-vNL3cTLQF_Tongrtckzfs8LS4ClkM&q=' + txt;
            map.classList.add('hidden'); // 地圖先消失
            map.addEventListener('load', () => {
              map.classList.remove('hidden');
              if(button)button.target.classList.remove('not-allow');
              //select stop animation
              select.classList.remove('active');
              //select result
              select.querySelector('li').innerHTML = txt;
              // console.log('txt:'+txt);
            }, false);
          }
          //清空創建列表亂數
          function creatDate(){
            select.innerHTML='';
            items.forEach(item=>{
              select.insertAdjacentHTML('beforeend','<li>'+item['shops']+'</li>');
            })
            //亂數
            const random = function(array){
              const max = array.length - 1;
              const min = 0;
              return Math.floor(Math.random() * (max - min + 1)) + min;
            };
            const shops = items[random(items)]['shops'];
            //亂數決定中選店家
            // console.log('亂數:');
            // console.log(txt);
            return shops;
          }
          //get data try obj 轉動速度
          function getData(datas){
            const array = [];
            for(var i in datas) {
              if(i>0){
                let item = {};
                item[datas[0][0]] = datas[i][0];
                item[datas[0][1]] = datas[i][1];
                array.push(item);
              }
            }
            const max = array.length - 1;
            const second = (0.1*max).toFixed(1);
            const text = array[0]['shops']
            select.style.animationDuration = second+"s";
            select.insertAdjacentHTML('beforeend','<li>'+text+'</li>');
            mapFn(text,button)
            // console.log('get json:');
            // console.log(datas);
            // console.log('try object:');
            // console.log(items);
            // console.table(items);
            return array;
          }
          //buttonFn
          function buttonFn(e){
            e.preventDefault();

            //禁止按鈕再被點擊
            e.target.classList.add('not-allow');

            //清空創建列表亂數
            const txt = creatDate();

            //select stare animation
            select.classList.add('active');

            //1.5s移除動畫 
            setTimeout(() => {
              // 改變地圖位置
              mapFn(txt,e);
            }, 2000);
          }
          //按鈕
          button.addEventListener('click',buttonFn)
        })
      </script>
  </div>
    <!-- <h2>心得筆記</h2> -->
    <!-- <h2>1.GCP新增新專案</h2>
    <p>
      進到
      <a href="https://console.cloud.google.com/welcome?project=constant-disk-141915&hl=zh-TW">Google Cloud Platform</a>
      的頁面按下新增專案，取好專案名稱後即可新增。
    </p>
    <h2>2.開通 Google Sheets API 功能</h2>
    <p>
      有了 GCP 的專案後，進到 API 程式庫：
      <a href="https://console.cloud.google.com/apis/library?hl=zh-TW">Google Cloud Platform</a>
      搜尋欄中搜尋「sheet」，會看到一項「Google Sheets API」：
    </p>
    <img src="https://i0.wp.com/i.imgur.com/MKOgxE2.png?w=840&ssl=1" alt="">
    <p>點擊後按下「啟用」，專案就會開通 Google Sheets API 的功能：</p>
    <img src="https://i0.wp.com/i.imgur.com/MbCk5V7.png?w=840&ssl=1" alt="">
    <h2>3.建立憑證</h2>
    <a href="https://console.cloud.google.com/apis/credentials/wizard?hl=zh-TW">網址</a>
    <img src="https://i0.wp.com/i.imgur.com/f9BITJH.png?w=840&ssl=1" alt="">
    <h2>4.建立 API 金鑰</h2>
    <img src="https://i0.wp.com/i.imgur.com/1Oey3Ae.png?w=840&ssl=1" alt="">
    <p>取得API 金鑰</p>
    <img src="https://i0.wp.com/i.imgur.com/oiTe1eb.png?w=840&ssl=1" alt="">
    <h2>Google Sheets URL</h2>
    <ul>
      <li>{表單id} 表單網址(../d/{表單id}/..)</li>
      <li>{表單名稱} 試算表的名稱</li>
    </ul>
    <pre class="prettyprint">
      <xmp>
        https://sheets.googleapis.com/v4/spreadsheets/{表單id}/values/{表單名稱}?alt=json&key={API金鑰}
      </xmp>
    </pre>
    <h2>範例:</h2>
    <pre class="prettyprint">
      <xmp>
        https://sheets.googleapis.com/v4/spreadsheets/{表單id}/values/{表單名稱}?alt=json&key={API金鑰}
      </xmp>
    </pre> -->
    <!-- <hr>
    <h4>參考</h4>
    <ul>
      <li>
        <a href="https://www.letswrite.tw/gas-google-sheet/" target="_blank">取得 Google Sheets / Excel 資料</a>
      </li>
      <li>
        <a href="https://www.letswrite.tw/google-excel-db/" target="_blank">Google Sheets / Excel 當作資料庫</a>
      </li>
    </ul> -->
  </body>
</html>
